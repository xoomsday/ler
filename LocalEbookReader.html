<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Local Ebook Reader</title>
  <link rel="stylesheet" href="ler.css">
  <link rel="stylesheet" href="ler-dark.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="LER.svg">
</head>
<body>
  <h1>Local Ebook Reader</h1>

  <div id="book-management">
    <div id="top-pane">
      <button id="open-file-button" class="button-like-label">+</button>
      <div id="library-controls">
        <span>Filter by:</span>
        <div id="state-filter" class="filter-dropdown">
          <button id="state-filter-btn" class="filter-btn">State</button>
          <div id="state-filter-options" class="filter-options">
            <label><input type="checkbox" name="state" value="unread" checked> Unread</label>
            <label><input type="checkbox" name="state" value="reading" checked> Reading</label>
            <label><input type="checkbox" name="state" value="finished" checked> Finished</label>
          </div>
        </div>
        <div id="tag-filter" class="filter-dropdown">
          <button id="tag-filter-btn" class="filter-btn">Tag</button>
          <div id="tag-filter-options" class="filter-options">
            <!-- Tag checkboxes will be populated by JS -->
          </div>
        </div>
        <div id="sorting">
          <span>Sort by:</span>
          <select id="sort-by">
            <option value="title">Title</option>
            <option value="last-read">Last Read</option>
          </select>
        </div>
      </div>
      <div id="app-menu" class="filter-dropdown">
        <button id="app-menu-btn" class="filter-btn">‚ãÆ</button>
        <div id="app-menu-options" class="filter-options">
          <a href="#" id="export-progress-menu-item">Export Progress</a>
          <a href="#" id="import-progress-menu-item">Import Progress</a>
          <a href="#" id="dark-mode-menu-item">Toggle Dark Mode</a>
          <a href="#" id="quit-app-menu-item">Quit</a>
        </div>
      </div>
      <input type="file" id="import-progress-file" accept=".json" style="display: none;">
      <div id="bulk-actions-pane" style="display: none;">
        <span id="selection-count">0 books selected</span>
        <button id="bulk-delete">Delete</button>
        <select id="bulk-state-change">
          <option value="">Mark as...</option>
          <option value="unread">Unread</option>
          <option value="reading">Reading</option>
          <option value="finished">Finished</option>
        </select>
        <select id="bulk-add-tag">
          <option value="">Add tag...</option>
        </select>
        <select id="bulk-remove-tag">
          <option value="">Remove tag...</option>
        </select>
        <button id="bulk-cancel">Cancel</button>
      </div>
      <div style="display: inline; position: absolute;
                  font-size: 8pt;
                  right: 2px; top: 0; opacity: 0.3"
           id="dateStamp">20251019.2120</div>
      </div>
    <div id="book-grid"></div>
    <div id="infinite-scroll-trigger" style="height: 50px;"></div>
  </div>

  <div id="reader-view" style="display: none;">
    <div id="reader-controls">
      <div id="top-reader-controls">
        <div class="trc-group">
          <button id="toc-button">‚ò∞</button>
          <button id="bookmark-button">üîñ</button>
        </div>
        <div class="trc-group">
          <div class="control-pill">
            <button id="font-size-dec">-</button>
            <span id="font-size-value">100%</span>
            <button id="font-size-inc">+</button>
          </div>
          <div class="control-pill">
            <button id="line-height-dec">-</button>
            <span id="line-height-value">1.5</span>
            <button id="line-height-inc">+</button>
          </div>
        </div>
        <div class="trc-group">
          <div class="control-pill" id="dark-mode-pill">
            <button id="dark-mode-toggle">üåô</button>
          </div>
          <div class="control-pill">
            <button id="font-toggle">A</button>
          </div>
          <div class="control-pill" id="tts-pill">
            <button id="tts-play">‚ñ∂Ô∏è</button>
            <button id="tts-pause" style="display: none;">‚è∏Ô∏è</button>
            <button id="tts-stop" style="display: none;">‚èπÔ∏è</button>
          </div>
          <div class="control-pill" id="tts-rate-pill">
            <span>Rate:</span>
            <button id="tts-rate-down">-</button>
            <span id="tts-rate-value">1.0</span>
            <button id="tts-rate-up">+</button>
          </div>
          <div class="control-pill" id="tts-pitch-pill">
            <span>Pitch:</span>
            <button id="tts-pitch-down">-</button>
            <span id="tts-pitch-value">1.0</span>
            <button id="tts-pitch-up">+</button>
          </div>
        </div>
        <div class="trc-group">
          <div class="control-pill" id="direction-toggle-pill">
            <button id="direction-toggle">LTR</button>
          </div>
          <div class="control-pill" id="spread-toggle-pill">
            <button id="spread-toggle">Split</button>
          </div>
        </div>
        <div class="trc-title-close-group">
          <div id="book-title-display"></div>
          <button id="close-reader">X</button>
        </div>
      </div>
      <div id="progress-slider-container">
        <input type="range" id="progress-slider" min="0" value="0" step="1">
        <div id="progress-labels">
          <span id="progress-current-label"></span> / <span id="progress-total-label"></span>
        </div>
      </div>
    </div>
    <div id="toc-overlay" style="display: none;"></div>
    <div id="viewer"></div>
    <div id="prev-page-area"></div>
    <div id="next-page-area"></div>
    <div id="help-overlay" style="display: none;">
      <h2>Help</h2>
      <div id="help-content"></div>
    </div>
  </div>

  <script src="jszip.min.js"></script>
  <script src="epub.min.js"></script>
  <script src="ler.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then((reg) => console.log('Service worker registered.', reg))
        .catch((err) => console.log('Service worker not registered.', err));
    }
  </script>

  <div id="tag-editor-overlay" style="display: none;">
    <div id="tag-editor-modal">
      <h2 id="tag-editor-title">Edit Tags for...</h2>
      <div class="tag-editor-section">
        <h3>Current Tags</h3>
        <div id="current-tags" class="tag-container"></div>
      </div>
      <div class="tag-editor-section">
        <h3>Add New Tag</h3>
        <div id="add-tag-form">
          <input type="text" id="new-tag-name" placeholder="Enter a new tag">
          <button id="add-tag-btn">Add</button>
        </div>
      </div>
      <div class="tag-editor-section">
        <h3>All Tags</h3>
        <div id="all-tags" class="tag-container"></div>
      </div>
      <div id="tag-editor-actions">
        <button id="tag-editor-cancel">Cancel</button>
        <button id="tag-editor-save">Save</button>
      </div>
    </div>
  </div>
</body>
</html>
